#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e

echo "-----> Cloning google/woff2"
cd $1
git clone --recursive https://github.com/google/woff2.git
cd woff2
git reset --hard 53846e1861e713c4fdcfea98492aef24f265e9e5
echo "-----> Compiling woff2"
make clean all

echo "-----> Cloning sfnt2woff"
cd $1
git clone https://github.com/samboy/WOFF.git sfnt2woff
cd sfnt2woff
echo "-----> Compiling sfnt2woff"
make


echo "-----> Cloning ttfautohint-build"
TMP_DIR=/tmp/ttfautohint-build
cd $1
git clone https://github.com/source-foundry/ttfautohint-build $TMP_DIR
cd $TMP_DIR
make


echo "-----> Adding .profile.d script"
mkdir -p $1/.profile.d
echo 'PATH=$PATH:$HOME/woff2:$HOME/sfnt2woff:$HOME/ttfautohint-build/local/bin' > $1/.profile.d/woff-tools.sh
